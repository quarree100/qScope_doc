
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Frontend &#8212; qScope-doc 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Communication" href="communication.html" />
    <link rel="prev" title="Tag Decoder" href="tag_decoder.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="frontend">
<h1>Frontend<a class="headerlink" href="#frontend" title="Permalink to this heading">¶</a></h1>
<p>The Q-Scope frontend, as used in the project QUARRE100, was programmed using <a class="reference external" href="pygame.org">pygame</a> - a set of Python modules designed for writing video games.</p>
<ul class="simple">
<li><p>TODO: Preprogrammed Q100-scripts</p></li>
<li><p>TODO: Advanced programming - making your own thing</p></li>
</ul>
<section id="frontend-installation">
<span id="id1"></span><h2>Frontend Installation<a class="headerlink" href="#frontend-installation" title="Permalink to this heading">¶</a></h2>
<p>After <a class="reference external" href="https://github.com/git-guides/git-clone">cloning</a> the frontend’s repository, you can simply install all required python modules by executing <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code>. (If the requirements.txt file is incomplete, and you run into problems, just install whichever module is missing via <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">[MODULE]</span></code>.)
Simply run the script via <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">run_q100viz.py</span></code></p>
</section>
<section id="understanding-the-frontend">
<h2>Understanding the Frontend<a class="headerlink" href="#understanding-the-frontend" title="Permalink to this heading">¶</a></h2>
<section id="file-structure">
<h3>File Structure<a class="headerlink" href="#file-structure" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>qScope_frontend
└───q100viz
    └───graphics
    |   contains tools for graph creation and image handling
    └───interaction
    |   &quot;gameplay&quot; modes and interaction with sliders
    └───settings
└───run_q100viz.py
</pre></div>
</div>
</section>
<section id="frontend-main-script">
<h3>Frontend Main Script<a class="headerlink" href="#frontend-main-script" title="Permalink to this heading">¶</a></h3>
<p>The main script is called <code class="docutils literal notranslate"><span class="pre">run_q100viz.py</span></code>. You can start it from the qScope_frontend folder by running <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">run_q100viz.py</span></code>. Some flags can be set to enable debug options:</p>
<blockquote id="frontent-startup-flags">
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--select_random</span> <span class="pre">[NUMBER_OF_HOUSES]</span></code>: preselects n houses to opt in for a connection to the heat grid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code>: activates verbose mode to print more information to console</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--simulate_until</span> <span class="pre">[NUMBER_OF_YEAR]</span></code>: run the gama-simulation until the given year. last simulation step will be last day before entered year.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--connect</span></code>: force buildings to opt in for “connection_to_heat_grid”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--refurbish</span></code>: force buildings to opt in for “refurbish”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--save_energy</span></code>: force buildings to opt in for “save_energy”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--start_at</span></code>: force the frontend to start at a certain <a class="reference internal" href="#frontend-mode">frontend_mode</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--test</span></code>:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--main_window</span></code>: forces the projection canvas to pop up at the current monitor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--research_model</span></code>: There are two simulation files provided. If specified, the research model will be used for simulation (rather than the workshop model)</p></li>
</ul>
</div></blockquote>
<p>These flags are specified in the first section of the main script.
At the end of the main script, an instance of the frontend is created and run in the loop. The frontend class itself is defined in q100viz/frontend.py.</p>
</section>
<section id="the-frontend-setup">
<span id="frontend-pygame-setup"></span><h3>The Frontend Setup<a class="headerlink" href="#the-frontend-setup" title="Permalink to this heading">¶</a></h3>
<p>The whole frontend was programmed using <a class="reference external" href="pygame.org">pygame</a> - a set of Python modules designed for writing video games. Pygame will create a graphical canvas, running in the loop, which will change its appearance according to user action.</p>
<p>Upon initialization of the frontend class, the pygame environment is created. Things like the display framerate, window position etc can be set here.</p>
<p id="frontend-setup-window">You can set the window’s position using the os module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set window position</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">run_in_main_window</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># left</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">2560</span>  <span class="c1"># height of upper monitor --&gt; display on lower monitor</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SDL_VIDEO_WINDOW_POS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">2560</span><span class="p">)</span>  <span class="c1"># projection to the left</span>
</pre></div>
</div>
<p>For this setting, the monitors should be organized as follows:</p>
<img alt="[Image of two schematic monitors, above each other and aligned left]" class="align-center" src="_images/frontend_screen-position.png" />
<p>The canvas is masked by a layer that defines the margins of the region of interest (ROI). The following list of points defines the extent of a masking polygon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">mask_points</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">85.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">85.5</span><span class="p">,</span> <span class="mi">82</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">82</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">],</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">]]</span>
</pre></div>
</div>
<p>The last step in the canvas initialization is the setup of the <a class="reference internal" href="communication.html#communication"><span class="std std-ref">Communication</span></a>.</p>
</section>
<section id="modes">
<span id="frontend-mode"></span><h3>Modes<a class="headerlink" href="#modes" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>there are different machine states, defined by the files in <code class="docutils literal notranslate"><span class="pre">q100viz/interaction/</span></code> → these are the modes the program is running at (per time)</p></li>
<li><dl class="simple">
<dt>implemented modes are:</dt><dd><ul>
<li><p><a class="reference internal" href="#buildings-interaction"><span class="std std-ref">Interaction</span></a></p></li>
<li><p><a class="reference internal" href="#simulation-mode"><span class="std std-ref">Simulation</span></a></p></li>
<li><p><a class="reference internal" href="#data-view"><span class="std std-ref">Data View</span></a></p></li>
<li><p><a class="reference internal" href="#calibration-mode"><span class="std std-ref">Calibration</span></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>each mode has a function called <code class="docutils literal notranslate"><span class="pre">activate()</span></code> which is used to (re-)active the mode and set the specific display settings accordingly. Do I want to see a slider (or two)? Shall the basemap be visible? Define it here.
The <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function is seldomly used, since it will be run in the beginning of the script (in <code class="docutils literal notranslate"><span class="pre">session.py</span></code>), before the variables (e.g. <code class="docutils literal notranslate"><span class="pre">grid</span></code>) are initialized.</p>
<section id="interaction">
<span id="buildings-interaction"></span><h4>Interaction<a class="headerlink" href="#interaction" title="Permalink to this heading">¶</a></h4>
<p>In the Input Mode, users can set household-, buildings- global parameters. They can leave the mode placing a token on the “simulation mode” selector.</p>
</section>
<section id="simulation">
<span id="simulation-mode"></span><h4>Simulation<a class="headerlink" href="#simulation" title="Permalink to this heading">¶</a></h4>
<p>The Simulation can be started using <code class="docutils literal notranslate"><span class="pre">S</span></code> key. It will generate an experiment API file for GAMA according to this scheme: <a class="reference external" href="https://gama-platform.org/wiki/Headless#simulation-output">https://gama-platform.org/wiki/Headless#simulation-output</a> and run the provided model file using the gama-headless.sh . These two files are to be set up in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p>
</section>
<section id="data-view">
<span id="id3"></span><h4>Data View<a class="headerlink" href="#data-view" title="Permalink to this heading">¶</a></h4>
</section>
</section>
</section>
<section id="setup-your-frontend">
<h2>Setup your frontend<a class="headerlink" href="#setup-your-frontend" title="Permalink to this heading">¶</a></h2>
<section id="coordinates">
<h3>coordinates:<a class="headerlink" href="#coordinates" title="Permalink to this heading">¶</a></h3>
<p><strong>ROI for distorted polygons:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize geographic viewport and basemap</span>

<span class="n">_gis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">gis</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">GIS</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span>
               <span class="c1"># northeast          northwest           southwest           southeast</span>
               <span class="p">[[</span><span class="mi">1013622</span><span class="p">,</span> <span class="mi">7207331</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013083</span><span class="p">,</span> <span class="mi">7207150</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013414</span><span class="p">,</span> <span class="mi">7206159</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013990</span><span class="p">,</span> <span class="mi">7206366</span><span class="p">]],</span>
               <span class="n">session</span><span class="o">.</span><span class="n">viewport</span><span class="p">)</span>


<span class="n">_gis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">gis</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">GIS</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span>
               <span class="c1"># northeast          northwest           southwest           southeast</span>
               <span class="p">[[</span><span class="mi">1013640</span><span class="p">,</span> <span class="mi">7207470</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013000</span><span class="p">,</span> <span class="mi">7207270</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013400</span><span class="p">,</span> <span class="mi">7206120</span><span class="p">],</span> <span class="p">[</span><span class="mi">1014040</span><span class="p">,</span> <span class="mi">7206320</span><span class="p">]],</span>
               <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<p>???</p>
<p><strong>kleinerer Kartenausschnitt:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_gis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">gis</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">GIS</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span>
               <span class="c1"># northeast          northwest           southwest           southeast</span>
               <span class="p">[[</span><span class="mi">1013578</span><span class="p">,</span> <span class="mi">7207412</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013010</span><span class="p">,</span> <span class="mi">7207210</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013386</span><span class="p">,</span> <span class="mi">7206155</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013953</span><span class="p">,</span> <span class="mi">7206357</span><span class="p">]],</span>
               <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>mit Input Area am linken Rand und Aussparung unten:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_gis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">gis</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">GIS</span><span class="p">(</span>
    <span class="n">canvas_size</span><span class="p">,</span>
    <span class="c1"># northeast          northwest           southwest           southeast</span>
    <span class="p">[[</span><span class="mi">1013554</span><span class="p">,</span> <span class="mi">7207623</span><span class="p">],</span> <span class="p">[</span><span class="mi">1012884</span><span class="p">,</span> <span class="mi">7207413</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013281</span><span class="p">,</span> <span class="mi">7206147</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013952</span><span class="p">,</span> <span class="mi">7206357</span><span class="p">]],</span>
    <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>mit Input Area am rechten Rand und Aussparung unten:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">gis</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">GIS</span><span class="p">(</span>
    <span class="n">canvas_size</span><span class="p">,</span>
    <span class="c1"># northeast          northwest           southwest           southeast</span>
    <span class="p">[[</span><span class="mi">1013631</span><span class="p">,</span> <span class="mi">7207409</span><span class="p">],</span> <span class="p">[</span><span class="mi">1012961</span><span class="p">,</span> <span class="mi">7207198</span><span class="p">],</span> <span class="p">[</span><span class="mi">1013359</span><span class="p">,</span> <span class="mi">7205932</span><span class="p">],</span> <span class="p">[</span><span class="mi">1014029</span><span class="p">,</span> <span class="mi">7206143</span><span class="p">]],</span>
    <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<section id="grid">
<h4>grid<a class="headerlink" href="#grid" title="Permalink to this heading">¶</a></h4>
<p><strong>single grid, upper left:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid_1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="p">[[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">50</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
<span class="n">grid_2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>16 x 22 grid rechts:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid_1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="p">[[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">72</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">72</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
<span class="n">grid_2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>18 x 22 grid rechts:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">grid_1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">,</span> <span class="p">[[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">81</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">81</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
<span class="n">grid_2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">viewport</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="drawing-on-canvas">
<h3>Drawing on Canvas<a class="headerlink" href="#drawing-on-canvas" title="Permalink to this heading">¶</a></h3>
<p><strong>displaying text</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. define font:</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># 2. use font to write to canvas:</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">700</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>drawing polygons onto a specific surface</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># general:</span>
<span class="c1"># points = [[x1, y1], [x1, y2], [x2, y1], [x2, y2]]</span>
<span class="c1">#          [[bottom-left], [top-left], [bottom-right], [top-right]]</span>
<span class="c1"># points_transformed = reference_surface.transform(points)</span>
<span class="c1"># pygame.draw.polygon(reference_surface, color, points_transformed)</span>

<span class="c1"># example:</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">70</span><span class="p">]]</span>  <span class="c1"># percentage relative to surface</span>
<span class="n">points_transformend</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">grid_1</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="c1">#                   surface,   color,      coords_transformed</span>
<span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">viewport</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">viewport</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">rect_points</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>display image</strong>
Pygame is able to load images onto Surface objects from PNG, JPG, GIF, and BMP image files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;images/scenario_progressive.bmp&quot;</span><span class="p">)</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>display sliders</strong>:
The sliders have a bool called <code class="docutils literal notranslate"><span class="pre">show_text</span></code> that, when <code class="docutils literal notranslate"><span class="pre">True</span></code>, activates the display of the slider control texts. This variable can be used for the usage modes to define whether the slider controls shall be displayed.</p>
</section>
<section id="keystone-transformation">
<h3>keystone transformation<a class="headerlink" href="#keystone-transformation" title="Permalink to this heading">¶</a></h3>
<p>general information on image transofrmation using opencv:</p>
<p><a class="reference external" href="https://docs.opencv.org/3.4/da/d6e/tutorial_py_geometric_transformations.html">tutorial_py_geometric_transformations</a></p>
<p><a class="reference external" href="https://docs.opencv.org/3.4/d2/de8/group__core__array.html#gad327659ac03e5fd6894b90025e6900a7">using cv.perspectiveTransform for vectors</a>
and <a class="reference external" href="https://docs.opencv.org/3.4/da/d54/group__imgproc__transform.html#gaf73673a7e8e18ec6963e3774e6a94b87">cv.warpPerspective for images</a></p>
<section id="adding-a-new-surface-draw-on-it-and-transform-it">
<h4>adding a new surface, draw on it and transform it:<a class="headerlink" href="#adding-a-new-surface-draw-on-it-and-transform-it" title="Permalink to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
  <span class="c1"># session.canvas_size = 1920, 1080</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">keystone</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">canvas_size</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">SRCALPHA</span><span class="p">)</span>

  <span class="c1"># x_size, y_size = 22, 22</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">src_points</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_size</span><span class="p">],</span> <span class="p">[</span><span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span><span class="p">],</span> <span class="p">[</span><span class="n">x_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">dst_points</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;X1&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">]],</span>
      <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;X1&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Y2&#39;</span><span class="p">]],</span>
      <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;X2&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Y2&#39;</span><span class="p">]],</span>
      <span class="p">[</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;X2&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;Y1&#39;</span><span class="p">]]]</span>
  <span class="c1"># where e.g. X1 = 0, X2 = 50, Y1 = 0, Y2 = 81.818</span>

  <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewport</span><span class="p">):</span>

    <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">[[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">70</span><span class="p">]])</span>  <span class="c1"># render polygon</span>

    <span class="n">viewport</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># cast it to viewport</span>
</pre></div>
</div>
<p>in file <code class="docutils literal notranslate"><span class="pre">q100viz/keystone.py</span></code></p>
</section>
<section id="recognition-data">
<h4>recognition/data<a class="headerlink" href="#recognition-data" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>from cspy via UDP (json)</p></li>
<li><p>definition via <code class="docutils literal notranslate"><span class="pre">cityscopy.json</span></code></p></li>
</ul>
</section>
<section id="frontend-representation">
<h4>frontend representation<a class="headerlink" href="#frontend-representation" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>slider uses the transformation of the grid</p></li>
<li><p><strong>drawing of polygons and values</strong> should be done via <code class="docutils literal notranslate"><span class="pre">self.surface.blit(...)</span></code>. Slider surface is rendered and “blitted” to main canvas.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">print(slider.coords_transformed)</span></code> returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mf">860.9641723632812</span><span class="p">,</span> <span class="mf">915.1583862304688</span><span class="p">],</span>
<span class="p">[</span><span class="mf">863.9833984375</span><span class="p">,</span> <span class="mf">614.8511352539062</span><span class="p">],</span>
<span class="p">[</span><span class="mf">1228.917724609375</span><span class="p">,</span> <span class="mf">622.6510009765625</span><span class="p">],</span>
<span class="p">[</span><span class="mf">1226.5196533203125</span><span class="p">,</span> <span class="mf">923.7374267578125</span><span class="p">]]</span>
</pre></div>
</div>
<p>with <code class="docutils literal notranslate"><span class="pre">[[bottom-left[x],</span> <span class="pre">bottom-left[y]],</span> <span class="pre">[upper-left[x],</span> <span class="pre">upper-left[y]],</span> <span class="pre">[upper-right[x],</span> <span class="pre">upper-right[y]],</span> <span class="pre">[bottom-right[x],</span> <span class="pre">bottom-right[y]]]</span></code></p>
</section>
<section id="calibration">
<span id="calibration-mode"></span><h4>Calibration<a class="headerlink" href="#calibration" title="Permalink to this heading">¶</a></h4>
<section id="examples">
<h5>examples:<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h5>
<p><strong>increase/decrease value by relative rotation:</strong></p>
<p>e.g. emission, in <code class="docutils literal notranslate"><span class="pre">InputMode.draw()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">rel_rot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
       <span class="n">i</span> <span class="o">=</span> <span class="n">get_intersection</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">buildings</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
       <span class="n">session</span><span class="o">.</span><span class="n">buildings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;CO2&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">20</span>
   <span class="k">elif</span> <span class="n">cell</span><span class="o">.</span><span class="n">rel_rot</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
       <span class="n">i</span> <span class="o">=</span> <span class="n">get_intersection</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">buildings</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
       <span class="n">session</span><span class="o">.</span><span class="n">buildings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;CO2&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">20</span>
</pre></div>
</div>
</section>
</section>
<section id="simulationmode">
<h4>SimulationMode<a class="headerlink" href="#simulationmode" title="Permalink to this heading">¶</a></h4>
<p>… will start the GAMA headless simulation and wait for the results.
You will have to have [GAMA](<a class="reference external" href="https://gama-platform.org/download">https://gama-platform.org/download</a>) installed. It’s best to choose the Version with JDK.
Q-Scope needs to know where to find the <code class="docutils literal notranslate"><span class="pre">gama-headless.sh</span></code> file, which can be found in the extracted folder <code class="docutils literal notranslate"><span class="pre">gama/headless</span></code>. Set this up in <code class="docutils literal notranslate"><span class="pre">config.py</span></code>, providing the headless folder and the location of the gama model file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;GAMA_HEADLESS_FOLDER&#39;</span> <span class="p">:</span> <span class="s1">&#39;/home/qscope/GAMA/headless/&#39;</span><span class="p">,</span>
<span class="s1">&#39;GAMA_MODEL_FILE&#39;</span> <span class="p">:</span> <span class="s1">&#39;../q100_abm/q100/models/qscope_ABM.gaml&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p><strong>ATTENTION</strong>: make sure to set the user rights of <code class="docutils literal notranslate"><span class="pre">gama-headless.sh</span></code> executable via <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">u+x</span> <span class="pre">gama-headless.sh</span></code></p>
</section>
<section id="questionnairemode">
<h4>QuestionnaireMode<a class="headerlink" href="#questionnairemode" title="Permalink to this heading">¶</a></h4>
<p>In this mode, the user will be confronted with questions that can be asked either
- via slider (only one or two user/s at a time)
- via grid (multiple users, using individual tokens)
(the options are yet to be decided)</p>
</section>
</section>
<section id="modeselector">
<h3>ModeSelector<a class="headerlink" href="#modeselector" title="Permalink to this heading">¶</a></h3>
<p>A ModeSelector is a specific cell on the grid, which, when selected via token, activates a certain Mode.</p>
<p><code class="docutils literal notranslate"><span class="pre">grid_1_setup.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">grid_2_setup.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">input_scenarios_grid_1.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">input_scenarios_grid_1.csv</span></code> are used to assign functionality to grid cells.</p>
<p>valid handles are:</p>
<p><strong>environment handles:</strong></p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text">environment handles</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>parameter</p></th>
<th class="head"><p>possible values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>alpha_scenario</p></td>
<td><p>Static_mean, Dynamic_moderate, Dynamic_high, Static_high</p></td>
</tr>
<tr class="row-odd"><td><p>carbon_price_scenario</p></td>
<td><p>A - Conservative, B - Moderate, C1 - Progressive, C2 - Progressive, C3 - Progressive</p></td>
</tr>
<tr class="row-even"><td><p>energy_price_scenario</p></td>
<td><p>Prices_Project start, Prices_2021, Prices_2022 1st half</p></td>
</tr>
<tr class="row-odd"><td><p>q100_price_opex_scenario</p></td>
<td><p>12 ct / kWh (static), 15-9 ct / kWh (dynamic)</p></td>
</tr>
<tr class="row-even"><td><p>q100_price_capex_scenario</p></td>
<td><p>1 payment, 2 payments, 5 payments</p></td>
</tr>
<tr class="row-odd"><td><p>q100_emissions_scenario</p></td>
<td><p>Constant_50g / kWh, Declining_Steps, Declining_Linear, <code class="docutils literal notranslate"><span class="pre">Constant_</span> <span class="pre">Zero</span> <span class="pre">emissions</span></code></p></td>
</tr>
</tbody>
</table>
<p><strong>household-individual handles:</strong></p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">household-individual handles</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>adjustable</p></th>
<th class="head"><p>parameter</p></th>
<th class="head"><p>possible values</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>o</p></td>
<td><p>my_heat_consumption</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>o</p></td>
<td><p>my_power_consumption</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>o</p></td>
<td><p>my_heat_expenses</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>o</p></td>
<td><p>my_power_expenses</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>o</p></td>
<td><p>my_heat_emissions</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>o</p></td>
<td><p>my_power_emissions</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>o</p></td>
<td><p>my_energy_emissions</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>✓</p></td>
<td><p>mod_status</p></td>
<td><p>‘u’, ‘s’</p></td>
</tr>
<tr class="row-even"><td><p>✓</p></td>
<td><p>spec_heat_consumption</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>✓</p></td>
<td><p>spec_power_consumption</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>✓</p></td>
<td><p>energy_source</p></td>
<td><p>gas, oil, None</p></td>
</tr>
</tbody>
</table>
<p>zusätzlich kann <cite>save_energy</cite> eingestellt werden als Einstellung von Agentenverhalten (TODO!)</p>
<p><strong>questionnaire</strong>:</p>
<ul class="simple">
<li><p>‘answer’ (deprecated?)</p></li>
</ul>
<p><strong>mode selection</strong>:</p>
<ul class="simple">
<li><p>‘start_input_scenarios’ (starts input mode A for global parameters)</p></li>
<li><p>‘start_input_households’ (input mode B for individual household parameters)</p></li>
<li><p>‘start_simulation’ (creates xml to start GAMA simulation)</p></li>
</ul>
<p><strong>colors</strong> can be set using strings from this list: <a class="reference external" href="https://www.pygame.org/docs/ref/color_list.html">https://www.pygame.org/docs/ref/color_list.html</a></p>
<p>The Modes can be switched using either the input keys:</p>
<ul class="simple">
<li><p>T: InputMode (TUI Mode)</p></li>
<li><p>C: CalibrationMode</p></li>
<li><p>S: Simulation</p></li>
</ul>
</section>
<section id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h3>
<p>JSON and CSV constructs used for the communication between GAMA, the Q-Scope-infoscreen and -frontend.</p>
<section id="starting-the-gama-simulation-via-xml">
<h4>Starting the GAMA Simulation via XML<a class="headerlink" href="#starting-the-gama-simulation-via-xml" title="Permalink to this heading">¶</a></h4>
<p>When moving from Input Mode to Simulation Mode (by Placing a Token on the according <a class="reference internal" href="#modeselector">ModeSelector</a>), an xml file is composed containing all the global environment data. The general structure looks like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Experiment&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;year&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;foerderung&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CO2-Preis&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CO2-emissions&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;versorgung&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;investment&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;anschluss&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;connection_speed&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/Parameter&gt;</span>
<span class="nt">&lt;/Experiment&gt;</span>
</pre></div>
</div>
<p>Composing the xml struct is done via <code class="docutils literal notranslate"><span class="pre">stats.to_xml</span></code> and receives single rows of a dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_xml</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
  <span class="n">xml</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;Experiment&gt;&#39;</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
      <span class="n">xml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  &lt;Parameter name=&quot;</span><span class="si">{0}</span><span class="s1">&quot;&gt;</span><span class="si">{1}</span><span class="s1">&lt;/Parameter&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">field</span><span class="p">]))</span>
  <span class="n">xml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/Experiment&gt;&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
</pre></div>
</div>
<p>and then in <cite>input_mode.py</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="c1"># enter simulation mode:</span>
<span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">grid_settings</span><span class="p">[</span><span class="s1">&#39;ncols&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">active_mode</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">simulation</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">deselect</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">grid_settings</span><span class="p">[</span><span class="s1">&#39;ncols&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">active_mode</span><span class="p">)</span>

    <span class="c1"># compose dataframe to start</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">environment</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xml</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">to_xml</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../data/simulation_df.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">qScope-doc</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag_decoder.html">Tag Decoder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frontend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#frontend-installation">Frontend Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#understanding-the-frontend">Understanding the Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-your-frontend">Setup your frontend</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="communication.html">Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="infoscreen.html">Infoscreen</a></li>
<li class="toctree-l1"><a class="reference internal" href="ABM.html">ABM</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tag_decoder.html" title="previous chapter">Tag Decoder</a></li>
      <li>Next: <a href="communication.html" title="next chapter">Communication</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, dunland.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/frontend.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>